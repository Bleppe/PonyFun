<div class="dashboard-container">
  <header class="dashboard-header">
    <div class="dashboard-header-content">
      <img src="/logo_transparent.png" alt="PonyFun Logo" class="dashboard-logo" />
      <div class="header-controls">
        <h1>V85 Analysis</h1>
        <div class="scrape-controls">
          <button class="scrape-btn secondary" (click)="triggerScrapeAll()" [disabled]="loading">
            {{ loading ? 'Searching...' : 'Find All Future Rounds' }}
          </button>
          <button class="scrape-btn" (click)="triggerScrape()" [disabled]="loading">
            {{ loading ? 'Scraping...' : 'Fetch Latest Data (ATG + SH)' }}
          </button>
        </div>
      </div>
    </div>
  </header>

  <section class="race-list">
    <div *ngIf="loading" class="spinner-container">
      <div class="spinner"></div>
    </div>

    <div *ngIf="!loading">
      <div class="venue-section" *ngFor="let key of getGroupKeys()">
        <div class="venue-header" (click)="toggleGroup(key)">
          <h2 class="venue-title">{{ key }}</h2>
          <span class="toggle-icon" [class.collapsed]="!isGroupExpanded(key)">â–¼</span>
        </div>
        <div class="cards-grid" *ngIf="isGroupExpanded(key)">
          <div class="race-card" *ngFor="let race of groupedRaces[key]">
            <h3>Race {{ race.race_number }}</h3>
            <p>Horses: {{ race.horse_count }}</p>
            <a [routerLink]="['/analysis', race.race_number]" [queryParams]="{ track: race.track, date: race.date }"
              class="analyze-link">View Analysis</a>
          </div>
        </div>
      </div>
    </div>

    <div *ngIf="!loading && upcomingRaces.length === 0" class="empty-state">
      No data available. Use the button above to scrape V85 data.
    </div>
  </section>

  <!-- Mascot -->
  <img src="/mascot_transparent.png" alt="Unicorn Pirate Mascot" class="mascot" />
</div>